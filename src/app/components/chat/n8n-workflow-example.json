{
  "name": "LeadsFlow - Chat Assistant",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "chat-message",
        "responseMode": "responseNode",
        "options": {}
      },
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.message.toLowerCase()}}",
              "operation": "contains",
              "value2": "lead"
            }
          ]
        }
      },
      "name": "Is About Leads?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [450, 300]
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "response",
              "value": "Para adicionar leads, voc√™ pode:\n\n1. **Importar de CSV/Excel**\n2. **Adicionar manualmente** no dashboard\n3. **Conectar via WhatsApp** (Evolution API)\n4. **Integrar com Facebook/Google Ads**\n\nQual m√©todo voc√™ prefere?"
            }
          ],
          "array": [
            {
              "name": "quickReplies",
              "value": "=[{\"text\": \"‚ûï Adicionar manualmente\", \"action\": \"navigate:/leads\"}, {\"text\": \"üì§ Importar CSV\", \"action\": \"import_csv\"}, {\"text\": \"üí¨ WhatsApp\", \"action\": \"whatsapp_integration\"}]"
            }
          ],
          "boolean": [
            {
              "name": "showSatisfaction",
              "value": false
            }
          ]
        }
      },
      "name": "Response - Leads",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [650, 200]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.message.toLowerCase()}}",
              "operation": "contains",
              "value2": "plano"
            }
          ]
        }
      },
      "name": "Is About Plans?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [650, 400]
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "response",
              "value": "Nossos planos:\n\n‚Ä¢ **Gratuito**: 30 leads/m√™s\n‚Ä¢ **Professional**: 500 leads/m√™s - R$97\n‚Ä¢ **Unlimited**: Leads ilimitados - R$197\n\nTodos os planos incluem 30 dias de acesso."
            }
          ],
          "array": [
            {
              "name": "quickReplies",
              "value": "=[{\"text\": \"üí≥ Ver Planos\", \"action\": \"navigate:/plans\"}, {\"text\": \"üìä Meu Plano Atual\", \"action\": \"current_plan\"}]"
            }
          ],
          "boolean": [
            {
              "name": "showSatisfaction",
              "value": false
            }
          ]
        }
      },
      "name": "Response - Plans",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [850, 300]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.message.toLowerCase()}}",
              "operation": "contains",
              "value2": "suporte"
            }
          ]
        }
      },
      "name": "Is About Support?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [850, 500]
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "response",
              "value": "Vou transferir voc√™ para nossa equipe de suporte. Um atendente humano responder√° em breve.\n\nEnquanto isso, voc√™ pode:\n‚Ä¢ Enviar email: suporte@leadsflow.com\n‚Ä¢ WhatsApp: +55 11 98765-4321"
            }
          ],
          "array": [
            {
              "name": "quickReplies",
              "value": "=[{\"text\": \"üìß Enviar Email\", \"action\": \"email_support\"}, {\"text\": \"üí¨ WhatsApp\", \"action\": \"whatsapp_support\"}]"
            }
          ],
          "boolean": [
            {
              "name": "showSatisfaction",
              "value": true
            }
          ]
        }
      },
      "name": "Response - Support",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [1050, 400]
    },
    {
      "parameters": {
        "model": "gpt-4",
        "messages": {
          "values": [
            {
              "role": "system",
              "message": "Voc√™ √© o assistente virtual do LeadsFlow, um CRM de gest√£o de leads. Responda de forma profissional, objetiva e em portugu√™s do Brasil. Use formata√ß√£o markdown quando apropriado. Seja √∫til e direto ao ponto."
            },
            {
              "role": "user",
              "message": "={{$json.message}}\n\nContexto:\n- P√°gina atual: {{$json.context.currentPage}}\n- Plano do usu√°rio: {{$json.context.userPlan}}"
            }
          ]
        },
        "options": {
          "temperature": 0.7,
          "maxTokens": 500
        }
      },
      "name": "OpenAI GPT-4",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [1050, 600],
      "credentials": {
        "openAiApi": {
          "id": "1",
          "name": "OpenAI API"
        }
      }
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "response",
              "value": "={{$json.choices[0].message.content}}"
            }
          ],
          "array": [
            {
              "name": "quickReplies",
              "value": "=[{\"text\": \"üìä Dashboard\", \"action\": \"navigate:/dashboard\"}, {\"text\": \"‚öôÔ∏è Configura√ß√µes\", \"action\": \"navigate:/settings\"}, {\"text\": \"üí¨ Falar com humano\", \"action\": \"contact_support\"}]"
            }
          ],
          "boolean": [
            {
              "name": "showSatisfaction",
              "value": false
            }
          ]
        }
      },
      "name": "Format AI Response",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [1250, 600]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{$json}}"
      },
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1450, 400]
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Is About Leads?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is About Leads?": {
      "main": [
        [
          {
            "node": "Response - Leads",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Is About Plans?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is About Plans?": {
      "main": [
        [
          {
            "node": "Response - Plans",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Is About Support?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is About Support?": {
      "main": [
        [
          {
            "node": "Response - Support",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "OpenAI GPT-4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Response - Leads": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Response - Plans": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Response - Support": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI GPT-4": {
      "main": [
        [
          {
            "node": "Format AI Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format AI Response": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {},
  "staticData": null
}
